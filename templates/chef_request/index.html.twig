{# templates/chef_request/index.html.twig #}
{% extends 'base.html.twig' %}

{% block body %}
    {% if is_granted('ROLE_USER') %}
        <h1>Request to Become a Chef</h1>

        {{ form_start(form) }}
            {{ form_widget(form) }}
            <button type="submit" class="btn btn-primary">Submit Request</button>
        {{ form_end(form) }}

        <a href="{{ path('chef_index') }}" class="btn btn-secondary">Back to Chefs List</a>
    {% elseif is_granted('ROLE_ADMIN') %}
        <h1>Manage Chef Requests</h1>

        {% if requests is not empty %}
            <table class="table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Request Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in requests %}
                        <tr>
                            <td>{{ request.user.username }}</td>
                            <td>
                                {% if request.isApproved %}
                                    Approved
                                {% elseif request.isRejected %}
                                    Rejected
                                {% else %}
                                    Pending
                                {% endif %}
                            </td>
                            <td>
                                {% if not request.isApproved and not request.isRejected %}
                                    <form method="post" action="{{ path('chef_request_approve', {'id': request.id}) }}" style="display:inline;">
                                        <input type="hidden" name="_token" value="{{ csrf_token('approve' ~ request.id) }}">
                                        <button type="submit" class="btn btn-success">Approve</button>
                                    </form>
                                    <form method="post" action="{{ path('chef_request_reject', {'id': request.id}) }}" style="display:inline;">
                                        <input type="hidden" name="_token" value="{{ csrf_token('reject' ~ request.id) }}">
                                        <button type="submit" class="btn btn-danger">Reject</button>
                                    </form>
                                {% endif %}
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="3">No requests found.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No requests to manage.</p>
        {% endif %}

        <a href="{{ path('homepage') }}" class="btn btn-secondary">Back to Home</a>
    {% else %}
        <p>You do not have permission to view this page.</p>
    {% endif %}
{% endblock %}
