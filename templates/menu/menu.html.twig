{% block title %}Menus{% endblock %}
{% extends 'base.html.twig' %}

{% block body %}
<div class="px-6  bg-gradient-to-r from-purple-400 via-indigo-300 to-blue-200">

    <h2 class="text-2xl font-bold text-center pt-10 mb-4">Menus</h2>
    <h6 class="text-lg font-medium text-center">
        De l'apéritif au dessert, plongez dans notre vaste sélection de plats irrésistibles et trouvez votre coup de cœur ! 
    </h6>

    <!-- Grid Layout for Menus -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 justify-center gap-8  py-10 ">
        {% for menu in menus %}
        <div class="bg-white rounded-lg shadow   m-auto flex flex-col  h-full w-full min-h-[500px] max-w-[400px]">
           
            <img class="rounded-t-lg w-full h-48 object-cover mb-4" src="{{ asset('images/menu_images/' ~ menu.picture) }}" alt="Menu Image" />
           
            <div class="flex flex-col flex-grow p-2">
                <h5 class="mb-2 text-2xl font-bold   text-center">{{ menu.title }}</h5>
                

                <p class="mb-4 font-normal   text-center">{{ menu.description }}</p>

                <!-- Display Products -->
                <h6 class="text-lg font-medium  bg-purple-100 mb-2">Produits</h6>
                <ul class="list-disc list-inside mb-4 px-4">
                    {% set product_count = 0 %}
                    {% for product in menu.products %}
                    {% if product_count < 3 %} <li>{{ product.name }}</li>
                        {% set product_count = product_count + 1 %}
                        {% endif %}
                        {% else %}
                        {% if product_count == 0 %}
                        <li>Aucun produit</li>
                        {% endif %}
                        {% endfor %}
                </ul>

                <!-- Display Categories -->
                <h6 class="text-lg font-medium bg-red-100 mb-2">Catégories</h6>
                <ul class="list-disc list-inside mb-4 px-4">
                    {% set category_count = 0 %}
                    {% for product in menu.products %}
                    {% if product.category is not null and category_count < 3 %} <li>{{ product.category.name }}</li>
                        {% set category_count = category_count + 1 %}
                        {% endif %}
                        {% endfor %}
                        {% if category_count == 0 %}
                        <li>Aucune catégorie</li>
                        {% endif %}
                </ul>
            </div>

            <div class="flex justify-between items-center mt-auto border-t border-gray-200 dark:border-gray-700 p-2">
                <button type="button"
                    class="inline-flex items-center px-4 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                    Acheter
                </button>

                <button type="button"
                    class="inline-flex items-center px-4 py-2 text-sm font-medium text-center text-white bg-green-700 rounded-lg hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800"
                    data-modal-target="commentModal{{ menu.id }}" data-modal-toggle="commentModal{{ menu.id }}">
                    Ajouter un commentaire
                </button>
            </div>
        </div>


        <div id="commentModal{{ menu.id }}" tabindex="-1" aria-hidden="true"
            class="fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50 hidden">
            <div class="relative bg-white rounded-lg shadow-lg w-full max-w-lg">
                <button type="button" class="absolute top-3 right-3 text-gray-400 hover:text-gray-900"
                    data-modal-hide="commentModal{{ menu.id }}">
                    <svg aria-hidden="true" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
                <div class="">
                    <h3 class="text-lg font-medium mb-4">Ajouter un commentaire pour {{ menu.title }}</h3>


                    {% if comments_by_menu[menu.id] is defined and comments_by_menu[menu.id] is not empty %}
                    <ul>
                        {% for comment in comments_by_menu[menu.id] %}
                        {% if comment is not null %}
                        <li id="comment-{{ comment.id }}">
                            {% if comment.customer is not null %}
                            <strong>{{ comment.customer.name }} :</strong> {{ comment.comment }}
                            {% if app.user and comment.customer.id == app.user.customer.id %}
                            <button class="btn btn-danger btn-sm mt-2" data-comment-id="{{ comment.id }}"
                                data-menu-id="{{ menu.id }}" onclick="removeComment(this)">Supprimer</button>
                            {% endif %}
                            {% else %}
                            <em>Aucun client associé</em>
                            {% endif %}
                        </li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>Aucun commentaire disponible pour ce menu.</p>
                    {% endif %}

                    <!-- Comment Form -->
                    <form id="commentForm{{ menu.id }}" data-menu-id="{{ menu.id }}" onsubmit="addComment(event)">
                        <div class="mb-4">
                            <textarea name="comment_text" rows="4" class="form-textarea w-full"
                                placeholder="Écrivez votre commentaire..."></textarea>
                        </div>
                        <div id="commentMessage{{ menu.id }}" class="mb-4 text-center"></div>
                        <button type="submit" class="btn btn-primary w-full">Ajouter un commentaire</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script src="{{ asset('javascript/modalMenu.js') }}"></script>
{% endblock %}