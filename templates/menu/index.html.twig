

{# templates/chef/menu.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Manage Menu{% endblock %}

{% block body %}
    <h1>Manage Menu</h1>

    <form id="menu-form">
        <input type="hidden" id="menu-id">
        <div>
            <label for="menu-name">Name</label>
            <input type="text" id="menu-name" name="name" required>
        </div>
        <div>
            <label for="menu-description">Description</label>
            <input type="text" id="menu-description" name="description" required>
        </div>
        <div>
            <label for="menu-price">Price</label>
            <input type="number" id="menu-price" name="price" required>
        </div>
        <button type="submit">Save Menu</button>
    </form>

    <h3>Menu Items</h3>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Chef</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="menu-list">
            {% for menu in menus %}
                <tr data-id="{{ menu.id }}">
                    <td>{{ menu.id }}</td>
                    <td>{{ menu.name }}</td>
                    <td>{{ menu.description }}</td>
                    <td>{{ menu.price }}</td>
                    <td>{{ menu.chef.name }}</td> {# Assurez-vous de changer l'acc√®s au nom de chef selon votre configuration #}
                    <td>
                        <button class="edit-menu">Edit</button>
                        <button class="delete-menu">Delete</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        document.getElementById('menu-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const menuId = document.getElementById('menu-id').value;
            const name = document.getElementById('menu-name').value;
            const description = document.getElementById('menu-description').value;
            const price = document.getElementById('menu-price').value;

            const url = menuId ? `/chef/menu/edit/${menuId}` : '/chef/menu/create';
            const method = 'POST';

            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: name, description: description, price: price })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    if (menuId) {
                        const row = document.querySelector(`tr[data-id="${menuId}"]`);
                        row.children[1].textContent = data.name;
                        row.children[2].textContent = data.description;
                        row.children[3].textContent = data.price;
                    } else {
                        const tbody = document.getElementById('menu-list');
                        const row = document.createElement('tr');
                        row.setAttribute('data-id', data.id);
                        row.innerHTML = `
                            <td>${data.id}</td>
                            <td>${data.name}</td>
                            <td>${data.description}</td>
                            <td>${data.price}</td>
                            <td>${data.chef}</td> {# Assurez-vous de changer l'affichage du nom du chef selon votre configuration #}
                            <td>
                                <button class="edit-menu">Edit</button>
                                <button class="delete-menu">Delete</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }

                    // Reset form
                    document.getElementById('menu-id').value = '';
                    document.getElementById('menu-form').reset();
                }
            });
        });

        document.getElementById('menu-list').addEventListener('click', function(event) {
            if (event.target.classList.contains('edit-menu')) {
                const row = event.target.closest('tr');
                const id = row.getAttribute('data-id');
                const name = row.children[1].textContent;
                const description = row.children[2].textContent;
                const price = row.children[3].textContent;

                document.getElementById('menu-id').value = id;
                document.getElementById('menu-name').value = name;
                document.getElementById('menu-description').value = description;
                document.getElementById('menu-price').value = price;
            }

            if (event.target.classList.contains('delete-menu')) {
                const row = event.target.closest('tr');
                const id = row.getAttribute('data-id');

                fetch(`/chef/menu/delete/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        row.remove();
                    } else {
                        alert('Error deleting menu item');
                    }
                });
            }
        });
    </script>
{% endblock %}

